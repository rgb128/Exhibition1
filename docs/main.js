(()=>{"use strict";var t,e,i,o={651:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.currentTouchMoveSpeed=e.CONFIG=void 0;var i,o=function(){this.defaults={x:0,y:0},this.portalsMoveWhenYouAreInPortal=!0,this.screen={width:document.documentElement.clientWidth,height:document.documentElement.clientHeight,data:{x:this.defaults.x,y:this.defaults.y,portalIn:void 0}},this.one=(this.screen.width+this.screen.height-Math.abs(this.screen.width-this.screen.height))/2,this.portalDefaults={speed:.7,z:5*-this.one,x:0,y:0,width:this.one/4,height:this.one/4,length:3*this.one,xCreationRadius:1*this.one,yCreationRadius:1*this.one},this.consts={perspective:this.one/3,container:document.getElementById("screen"),movingDelta:.1*this.one,creationMs:1500,maxTouchMoveSpeed:2},this.position={x:this.defaults.x,y:this.defaults.y}};e.CONFIG=i;var n=document.getElementById("container");function s(){e.CONFIG=i=new o,n.style.perspective=i.consts.perspective+"px"}s(),window.addEventListener("resize",(function(t){s()})),e.currentTouchMoveSpeed={x:0,y:0}},299:(t,e,i)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.Popup=void 0;var o=i(651),n=function(){function t(){var t=this;this.ondocumentclick=function(e){t.root.remove(),document.documentElement.requestFullscreen(),document.documentElement.removeEventListener("click",t.ondocumentclick)},this.root=this.createRoot()}return t.prototype.show=function(){document.body.appendChild(this.root),document.documentElement.addEventListener("click",this.ondocumentclick)},t.prototype.createRoot=function(){var t=document.createElement("div");t.classList.add("popup");var e=o.CONFIG.screen.width>o.CONFIG.screen.height;return t.innerHTML=e?"Перемещайся. Клацни, и начинай игру.":"Перемещайся. Тыкни, и начинай игру.",t},t}();e.Popup=n},248:function(t,e,i){var o,n=this&&this.__extends||(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(t,e)},function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function i(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)});Object.defineProperty(e,"__esModule",{value:!0}),e.Portal=e.PortalHTML=void 0;var s=i(651),r=i(491),a=i(41),l=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return n(e,t),e}(HTMLElement);e.PortalHTML=l;var h=function(){function t(t,e,i,o,n,r,a){this.x=t,this.y=e,this.distance=i,this.width=o,this.height=n,this.length=r,this.speed=a,this.root=document.createElement("div"),this.root.context=this,this.root.classList.add("portal"),this.root.style.width=this.width+"px",this.root.style.height=this.height+"px",this.walls=this.drawWalls(),this.onresize(),this.redraw(),s.CONFIG.consts.container.appendChild(this.root)}return t.prototype.redraw=function(){var t=s.CONFIG.screen.width/2+this.x-this.width/2,e=s.CONFIG.screen.height/2+this.y-this.height/2,i=this.distance;this.root.style.top=e+"px",this.root.style.left=t+"px",this.root.style.transform="translateZ("+i+"px)",this.onresize()},t.prototype.tick=function(t){var e=this.speed*t;this.distance+=e,this.root.style.transform="translateZ("+this.distance+"px)";var i=s.CONFIG.consts.perspective,o=this.length+s.CONFIG.consts.perspective;if(s.CONFIG.screen.data.portalIn===this){var n=r.map(this.distance,i,o,1,0);if(this.walls.end.style.opacity=""+n,this.distance>=o)return s.CONFIG.screen.data.portalIn=void 0,void this.root.remove()}else if(this.clipPath(),this.distance>=i){if(this.isUserInPortal(s.CONFIG.screen.data.x,s.CONFIG.screen.data.y)){if(s.CONFIG.screen.data.portalIn=this,s.CONFIG.portalsMoveWhenYouAreInPortal)for(var a=0,l=Array.from(document.querySelectorAll("#screen > .portal"));a<l.length;a++){var h=l[a].context;h!==this&&(h.distance-=this.length,h.clipPath())}return}return void this.root.remove()}},t.prototype.drawWalls=function(){var t=a.buildWalls(this.width,this.height,this.length);return this.root.appendChild(t.left),this.root.appendChild(t.right),this.root.appendChild(t.top),this.root.appendChild(t.bottom),this.root.appendChild(t.end),t},t.prototype.onresize=function(){this.walls.left.style.width=this.length+"px",this.walls.left.style.height=this.height+"px",this.walls.right.style.left=this.width+"px",this.walls.right.style.width=this.length+"px",this.walls.right.style.height=this.height+"px",this.walls.top.style.width=this.width+"px",this.walls.top.style.height=this.length+"px",this.walls.bottom.style.top=this.height+"px",this.walls.bottom.style.width=this.width+"px",this.walls.bottom.style.height=this.length+"px",this.walls.end.style.width=this.width+"px",this.walls.end.style.height=this.height+"px",this.walls.end.style.transform="translateZ(-"+this.length+"px)",this.clipPath()},t.prototype.clipPath=function(){var t=this.walls,e=-1*this.distance+s.CONFIG.consts.perspective,i=s.CONFIG.screen.data.x+this.x,o=s.CONFIG.screen.data.y+this.y,n=this.width,r=this.height,a=this.length;if(t.left){if(i>n/2)t.left.style.width="0px";else if(i<-(n*e/a+n/2)){var l=n*e/(-i-n/2);t.left.style.width=l+"px"}else t.left.style.width=a+"px";if(-o>r/2){var h=r*e/(-o-r/2);t.left.style.clipPath="polygon(0px 0px, "+h+"px 0px, 0px "+r+"px"}else if(o>r/2){var p=r*e/(o-r/2);t.left.style.clipPath="polygon(0px 0px, "+p+"px "+r+"px, 0px "+r+"px"}else t.left.style.clipPath="none"}if(t.right&&(-i>n/2?t.right.style.width="0px":i>n*e/a+n/2?(l=n*e/(i-n/2),t.right.style.width=l+"px"):t.right.style.width=a+"px",-o>r/2?(h=r*e/(-o-r/2),t.right.style.clipPath="polygon(0px 0px, "+h+"px 0px, 0px "+r+"px"):o>r/2?(p=r*e/(o-r/2),t.right.style.clipPath="polygon(0px 0px, "+p+"px "+r+"px, 0px "+r+"px"):t.right.style.clipPath="none"),t.top)if(o>r/2?t.top.style.height="0px":o<-(r*e/a+r/2)?(l=r*e/(-o-r/2),t.top.style.height=l+"px"):t.top.style.height=a+"px",i>n/2){var c=n*e/(i-n/2);t.top.style.clipPath="polygon(0px 0px, "+n+"px "+c+"px, "+n+"px 0px)"}else if(-i>n/2){var d=n*e/(-i-n/2);t.top.style.clipPath="polygon("+n+"px 0px, 0px "+d+"px, 0px 0px)"}else t.top.style.clipPath="none";if(t.bottom&&(-o>r/2?t.bottom.style.height="0px":o>r*e/a+r/2?(l=r*e/(o-r/2),t.bottom.style.height=l+"px"):t.bottom.style.height=a+"px",i>n/2?(c=n*e/(i-n/2),t.bottom.style.clipPath="polygon(0px 0px, "+n+"px "+c+"px, "+n+"px 0px)"):-i>n/2?(d=n*e/(-i-n/2),t.bottom.style.clipPath="polygon("+n+"px 0px, 0px "+d+"px, 0px 0px)"):t.bottom.style.clipPath="none"),t.end){var u=a*(-i-n/2)/e;u=(u=n-u)<0?0:u>n?n:u;var v=a*(i-n/2)/e;v=v<0?0:v>n?n:v;var x=a*(-o-r/2)/e;x=(x=r-x)<0?0:x>r?r:x;var y=a*(o-r/2)/e;y=y<0?0:y>r?r:y,t.end.style.clipPath="polygon("+u+"px "+x+"px, "+v+"px "+x+"px, "+v+"px "+y+"px, "+u+"px "+y+"px)"}},t.prototype.isUserInPortal=function(t,e){var i=-t,o=-e,n=this.x-this.width/2,s=this.x+this.width/2,r=this.y-this.height/2,a=this.y+this.height/2;return i>n&&i<s&&o>r&&o<a},t}();e.Portal=h},82:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.Walls=void 0;e.Walls=function(t,e,i,o,n){this.left=t,this.right=e,this.top=i,this.bottom=o,this.end=n}},564:(t,e,i)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.addMovingListeners=void 0;var o=i(651),n=i(491),s=void 0,r=void 0;e.addMovingListeners=function(){window.addEventListener("keydown",(function(t){var e=t.code,i=o.CONFIG.screen.data.x,n=o.CONFIG.screen.data.y;if("ArrowUp"===e||"KeyW"===e?n+=o.CONFIG.consts.movingDelta:"ArrowDown"===e||"KeyS"===e?n-=o.CONFIG.consts.movingDelta:"ArrowRight"===e||"KeyD"===e?i-=o.CONFIG.consts.movingDelta:"ArrowLeft"!==e&&"KeyA"!==e||(i+=o.CONFIG.consts.movingDelta),!o.CONFIG.screen.data.portalIn||o.CONFIG.screen.data.portalIn.isUserInPortal(i,n)){o.CONFIG.screen.data.x=i,o.CONFIG.screen.data.y=n;for(var s=0,r=Array.from(document.querySelectorAll("#screen > .portal"));s<r.length;s++){var a=r[s].context;a&&a!==o.CONFIG.screen.data.portalIn&&a.clipPath()}}})),window.addEventListener("touchstart",(function(t){var e=l(t);s=e.x,r=e.y,o.currentTouchMoveSpeed.x=0,o.currentTouchMoveSpeed.y=0})),window.addEventListener("touchend",(function(t){s=void 0,r=void 0,o.currentTouchMoveSpeed.x=0,o.currentTouchMoveSpeed.y=0})),window.addEventListener("touchmove",(function(t){var e=l(t);if(void 0!==s&&void 0!==r){var i=e.x-s,a=e.y-r,h=o.CONFIG.screen.width,p=o.CONFIG.screen.height,c=o.CONFIG.consts.maxTouchMoveSpeed,d=n.map(i,-h,h,-c,c),u=n.map(a,-p,p,-c,c);o.currentTouchMoveSpeed.x=d,o.currentTouchMoveSpeed.y=u}})),window.addEventListener("touchcancel",(function(t){s=void 0,r=void 0,o.currentTouchMoveSpeed.x=0,o.currentTouchMoveSpeed.y=0}))};var a=function(t,e){this.x=t,this.y=e};function l(t){var e=t.touches[0].screenX,i=t.touches[0].screenY;return new a(e,i)}},606:(t,e,i)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.animate=void 0;var o=i(651),n=i(248),s=i(491),r=performance.now(),a=void 0;e.animate=function t(e){"number"!=typeof e&&(e=0);var i=e-r;r=e,void 0===a&&(a=o.CONFIG.consts.creationMs),a>=o.CONFIG.consts.creationMs&&!o.CONFIG.screen.data.portalIn&&(a=0,new n.Portal(-o.CONFIG.screen.data.x+s.map(Math.random(),0,1,-o.CONFIG.portalDefaults.xCreationRadius,o.CONFIG.portalDefaults.xCreationRadius),-o.CONFIG.screen.data.y+s.map(Math.random(),0,1,-o.CONFIG.portalDefaults.yCreationRadius,o.CONFIG.portalDefaults.yCreationRadius),o.CONFIG.portalDefaults.z,o.CONFIG.portalDefaults.width,o.CONFIG.portalDefaults.width,o.CONFIG.portalDefaults.length,o.CONFIG.portalDefaults.speed)),a+=i;var l=o.CONFIG.screen.data.x,h=o.CONFIG.screen.data.y;if(l+=o.currentTouchMoveSpeed.x*i,h+=o.currentTouchMoveSpeed.y*i,o.CONFIG.screen.data.portalIn?o.CONFIG.screen.data.portalIn.isUserInPortal(l,h)&&(o.CONFIG.screen.data.x=l,o.CONFIG.screen.data.y=h):(o.CONFIG.screen.data.x=l,o.CONFIG.screen.data.y=h),o.CONFIG.consts.container.style.left=o.CONFIG.screen.data.x+"px",o.CONFIG.consts.container.style.top=o.CONFIG.screen.data.y+"px",o.CONFIG.screen.data.portalIn&&!o.CONFIG.portalsMoveWhenYouAreInPortal)o.CONFIG.screen.data.portalIn.tick(i);else for(var p=0,c=Array.from(document.querySelectorAll("#screen > .portal"));p<c.length;p++)c[p].context.tick(i);requestAnimationFrame(t)}},41:(t,e,i)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.buildWalls=void 0;var o=i(82);e.buildWalls=function(t,e,i){var n=function(t){var e=document.createElement("div");e.classList.add("left-wall");var i=document.createElement("div");return i.classList.add("grid"),i.style.borderWidth=t+"px",e.appendChild(i),e}(t/33),s=function(){var t=document.createElement("div");t.classList.add("right-wall");for(var e=1;e<=3;e-=-1){var i=document.createElement("div");i.classList.add("painting","painting"+e),t.appendChild(i)}return t}(),r=function(){var t=document.createElement("div");return t.classList.add("top-wall"),t}(),a=function(){var t=document.createElement("div");return t.classList.add("bottom-wall"),t}(),l=function(){var t=document.createElement("div");return t.classList.add("end"),t}();return new o.Walls(n,s,r,a,l)}},491:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.map=void 0,e.map=function(t,e,i,o,n){var s=t-e;return(s*=(n-o)/(i-e))+o}}},n={};function s(t){if(n[t])return n[t].exports;var e=n[t]={exports:{}};return o[t].call(e.exports,e,e.exports,s),e.exports}t=s(564),e=s(606),i=s(299),t.addMovingListeners(),window.addEventListener("resize",(function(t){for(var e=0,i=Array.from(document.querySelectorAll("#screen > .portal"));e<i.length;e++)i[e].context.redraw()})),(new i.Popup).show(),e.animate()})();